---
title: "Caso Práctico R"
output: html_notebook
---

Toma el dataset IBM.csv y realiza el siguiente análisis exploratorio:

* Carga el dataset como dataframe (el valor 999 es nulo) y muestra sus primeras filas, su resúmen estadístico y la estructura de sus columnas.
* Reemplaza todos los valores nulos de la columna "Open", por su mediana
* Divide la columna "Date" en "Dia", "Mes" y "Año".
* Cambia la columna Año a factor.
* Devuelve el precio más alto de cada año.
* Muestra una tabla de frecuencias para cada año.
* Obtén una nueva columna que se llame "Diferencias" y que se el resultado de restar al precio más alto el precio más bajo.
* Ordena el dataset de forma ascendente por la columna "Diferencias".
* Muestra un resúmen estadístico del dataset en función de los siguientes valores por cada año:
  + Precio más alto de apertura.
  + Precio más bajo de cierre.
  + Media de la columna "Diferencia".
  + Número de elementos para cada año.
* Muestra el sumatorio de la variable Volumen para todos los años.
* Obtén dos histogramas para las variables de precio de apertura y cierre, rellena los histogramas en función del año.
* Muestra un diagrama de dispersión entre los precios más altos y más bajos, además muestra su recta de ajuste.
* Obtén un diagrama de caja y bigotes de la variable Adj.Close por año.
* Muestra para cada año un diagrama de densidad para la variable "Volume".

```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
```
* Carga el dataset como dataframe (el valor 999 es nulo) y muestra sus primeras filas, su resúmen estadístico y la estructura de sus columnas.
```{r}
df <- read.csv("IBM.csv", header = T, na.strings = 999)
```
```{r}
head(df)
summary(df)
str(df)
```
* Reemplaza todos los valores nulos de la columna "Open", por su mediana
```{r}
df$Open[which(is.na(df$Open))] <- median(df$Open, na.rm = T)
summary(df)
```
* Divide la columna "Date" en "Dia", "Mes" y "Año".
```{r}
df <- separate(df, Date, into = c("Dia", "Mes", "Año"), sep = "/")
head(df)
colnames(df)
```
* Cambia la columna Año a factor.
```{r}
df$Año <- as.factor(df$Año)
str(df)
```
* Devuelve el precio más alto de cada año.
```{r}
df %>% select(Año, High) %>% group_by(Año) %>% summarise(max_año = max(High))
```
* Muestra una tabla de frecuencias para cada año.
```{r}
table(df$Año)
```
* Obtén una nueva columna que se llame "Diferencias" y que se el resultado de restar al precio más alto el precio más bajo.
```{r}
df$Diferencias <- df$High - df$Low
summary(df)
```
* Ordena el dataset de forma ascendente por la columna "Diferencias".
```{r}
df <- arrange(df,Diferencias)
head(df)
```
* Muestra un resúmen estadístico del dataset en función de los siguientes valores por cada año:
  + Precio más alto de apertura.
  + Precio más bajo de cierre.
  + Media de la columna "Diferencia".
  + Número de elementos para cada año.
```{r}
df %>% select(Open, Close, Diferencias, Año) %>% group_by(Año) %>% summarise(
  max_apertura = max(Open),
  min_cierre = min(Close),
  media_diferencia = mean(Diferencias),
  elementos_año = n()
)
```
* Muestra el sumatorio de la variable Volumen para todos los años.
```{r}
tapply(df$Volume, df$Año, sum)
```
* Obtén dos histogramas para las variables de precio de apertura y cierre, rellena los histogramas en función del año.
```{r}
ggplot(df) +
  geom_histogram(mapping = aes(Open, fill = Año)) + 
  ggtitle("Apertura ~Año")

ggplot(df) +
  geom_histogram(mapping = aes(Close, fill = Año)) + 
  ggtitle("Cierre ~Año")

```
* Muestra un diagrama de dispersión entre los precios más altos y más bajos, además muestra su recta de ajuste.
```{r}
ggplot(df) + 
  geom_point(mapping = aes(x = High, y = Low)) +
  geom_smooth(aes(x =High, y = Low), method = lm)
```
* Obtén un diagrama de caja y bigotes de la variable Adj.Close por año.
```{r}
ggplot(df) + 
  geom_boxplot(mapping = aes(x = Adj.Close, fill = Año)) + coord_flip()
```
* Muestra para cada año un diagrama de densidad para la variable "Volume".
```{r}
ggplot(df) + 
  geom_density(mapping = aes(Volume, colour = Año)) +
  facet_wrap(~Año)
```



