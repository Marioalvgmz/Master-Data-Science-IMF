---
title: "Ejercicio R Mario Álvarez Gómez"
output: html_notebook
---

# Ejercicio Final R
Se dispone del siguiente archivo CSV con información sobre los Air Bnb de la ciudad de Milán en 2019. En el dataset, solamente aparecen apartamentos completos.

El dataset original y la explicación de todas las columnas está disponible en el siguiente enlace: https://www.kaggle.com/antoniokaggle/milan-airbnb-open-data-only-entire-apartments  

Con esta información, alumno debe realizar los siguientes procesos de analítica:

1. Cargar el archivo “Airbnb_Milan.csv” como dataframe.
2. Crear un nuevo dataframe que contenga únicamente las siguientes columnas:

    - “host_is_superhost”
    - “host_identity_verified”
    - “bathrooms”
    - “bedrooms”
    - “daily_price”
    - “security_deposit”
    - “minimum_nights”
    - “number_of_reviews”
    - “review_scores_rating”
3. Cambiar los factores de la variable “host_is_superhost” de 0, 1 a: “SI” y, “NO”. (investigar la función recode).
4. Cambiar los factores de la variable “host_identity_verified” de 0, 1 a: “VERIFICA” y “NO VERIFICA”.
5. Mostrar un resumen estadístico de los datos.
6. Filtrar el dataset por apartamentos cuyo mínimo de noches sea igual o menor que siete.
7. ¿Cuál es el precio medio por día de una habitación en función de si el anfitrión tiene verificado o no su perfil?
8. Quién tiene más número de reseñas, ¿un super host o no super host?
9. Sobre la estadística anterior ¿quién tiene la puntuación media más alta?
10. Crea un vector categórico llamado “CATEGORÍA”, en función de que, si para la puntuación de las reseñas tiene de 0 a 49, sea “NO ACONSEJABLE”; de 50 a 75 sea “ESTÁNDAR”; y de 76 a 100 sea “TOP”.
11. Mostrar las frecuencias de la variable CATEGORÍA.
12. Obtener el histograma del precio por día.
13. Estudiar la relación entre los dormitorios y baños de forma gráfica.
14. Mostrar un histograma del número de reseñas en función de si es un usuario verificado o no.
15. Mostrar un histograma por cada valor de “CATEGORÍA” en el que se enseñe la cuantía del depósito de seguridad en función de si el anfitrión es super host o no.


 1. Cargar el archivo “Airbnb_Milan.csv” como dataframe.
```{r}
milan <- read.csv("Airbnb_Milan.csv", header = T)

```
```{r}
head(milan)

```

 2. Crear un nuevo dataframe que contenga únicamente las siguientes columnas:

    - “host_is_superhost”
    - “host_identity_verified”
    - “bathrooms”
    - “bedrooms”
    - “daily_price”
    - “security_deposit”
    - “minimum_nights”
    - “number_of_reviews”
    - “review_scores_rating”
```{r}
library(dplyr)
library(tidyr)
```

```{r}
df <- milan %>% select(host_is_superhost, host_identity_verified, bathrooms, bedrooms, daily_price, security_deposit, minimum_nights, number_of_reviews, review_scores_rating)
head(df)
```
3. Cambiar los factores de la variable “host_is_superhost” de 0, 1 a: “SI” y, “NO”. (investigar la función recode).
```{r}
df <- df %>% mutate(host_is_superhost=recode(host_is_superhost, 
                                             "0" = "SI", 
                                             "1" = "NO"))

# Convertir a factores
df$host_is_superhost <- as.factor(df$host_is_superhost)
```
```{r}

str(df)
```
4. Cambiar los factores de la variable “host_identity_verified” de 0, 1 a: “VERIFICA” y “NO VERIFICA”.
```{r}
df <- df %>% mutate(host_identity_verified=recode(host_identity_verified, 
                                             "0" = "VERIFICA", 
                                             "1" = "NO VERIFICA"))

# Convertir a factores
df$host_identity_verified <- as.factor(df$host_identity_verified)
```
```{r}
str(df)
```
5. Mostrar un resumen estadístico de los datos.
```{r}
summary(df)
```
6. Filtrar el dataset por apartamentos cuyo mínimo de noches sea igual o menor que siete.
```{r}
filter(df,minimum_nights <= 7)

```
7. ¿Cuál es el precio medio por día de una habitación en función de si el anfitrión tiene verificado o no su perfil?
```{r}
df %>% group_by(host_identity_verified) %>% summarise(precio_medio = mean(daily_price))
```
8. Quién tiene más número de reseñas, ¿un super host o no super host?
```{r}
df %>% group_by(host_is_superhost) %>% summarise(múmero_reseñas = sum(number_of_reviews))
```
9. Sobre la estadística anterior ¿quién tiene la puntuación media más alta?
```{r}
df %>% group_by(host_is_superhost) %>% summarise(media_reseñas = mean(number_of_reviews))
```
10. Crea un vector categórico llamado “CATEGORÍA”, en función de que, si para la puntuación de las reseñas tiene de 0 a 49, sea “NO ACONSEJABLE”; de 50 a 75 sea “ESTÁNDAR”; y de 76 a 100 sea “TOP”.
```{r}
df["CATEGORIA"] <- factor(ifelse(df$review_scores_rating <= 49, "NO ACONSEJABLE", ifelse(df$review_scores_rating <= 75, "ESTANDAR", "TOP")))
head(df)
```
11. Mostrar las frecuencias de la variable CATEGORÍA.
```{r}
table(df$CATEGORIA)
```
12. Obtener el histograma del precio por día.
```{r}
library(plotly)
```
```{r}
fig <- plot_ly(
  data = df,
  x = ~daily_price,
               alpha = 0.6,
               type = "histogram")
fig

```
13. Estudiar la relación entre los dormitorios y baños de forma gráfica.
```{r}
library(ggplot2)
```

```{r}
ggplot(df) +
  geom_point(mapping = aes(bedrooms, bathrooms)) + geom_smooth(aes(bedrooms, bathrooms), method = lm)
```
14. Mostrar un histograma del número de reseñas en función de si es un usuario verificado o no.
```{r}
fig.bar <- plot_ly( data = df, x = ~host_identity_verified, y = ~df$review_scores_rating, type = "bar")
fig.bar
```
15. Mostrar un histograma por cada valor de “CATEGORÍA” en el que se enseñe la cuantía del depósito de seguridad en función de si el anfitrión es super host o no.
```{r}
fig.bar <- plot_ly( data = df, x = ~CATEGORIA, y = ~security_deposit, type = "bar")
fig.bar
```

